"use strict";(globalThis.webpackChunkdocs=globalThis.webpackChunkdocs||[]).push([[7276],{8298(e,n,t){t.r(n),t.d(n,{assets:()=>l,contentTitle:()=>c,default:()=>d,frontMatter:()=>a,metadata:()=>s,toc:()=>o});const s=JSON.parse('{"id":"agui-subscriber","title":"AG-UI Subscriber Pattern","description":"AG-UI Subscriber Pattern","source":"@site/docs/agui-subscriber.md","sourceDirName":".","slug":"/agui-subscriber","permalink":"/mcp-ts/docs/agui-subscriber","draft":false,"unlisted":false,"editUrl":"https://github.com/zonlabs/mcp-ts/tree/main/docs/docs/agui-subscriber.md","tags":[],"version":"current","frontMatter":{"title":"AG-UI Subscriber Pattern","hide_title":true},"sidebar":"tutorialSidebar","previous":{"title":"Adapters","permalink":"/mcp-ts/docs/adapters"},"next":{"title":"MCP Apps","permalink":"/mcp-ts/docs/mcp-apps"}}');var r=t(4848),i=t(8453);const a={title:"AG-UI Subscriber Pattern",hide_title:!0},c=void 0,l={},o=[{value:"Overview",id:"overview",level:2},{value:"Architecture",id:"architecture",level:2},{value:"Installation",id:"installation",level:2},{value:"How AG-UI Subscriber Fits in the Flow",id:"how-ag-ui-subscriber-fits-in-the-flow",level:2},{value:"What Each Component Does",id:"what-each-component-does",level:3},{value:"Key Differences",id:"key-differences",level:3},{value:"Core Concepts",id:"core-concepts",level:2},{value:"McpAppEvent",id:"mcpappevent",level:3},{value:"Tool Name Handling",id:"tool-name-handling",level:3},{value:"React Hooks",id:"react-hooks",level:2},{value:"useMcpApps",id:"usemcpapps",level:3},{value:"useAguiSubscriber",id:"useaguisubscriber",level:3},{value:"useToolCallEvents",id:"usetoolcallevents",level:3},{value:"Framework-Agnostic Usage",id:"framework-agnostic-usage",level:2},{value:"Basic Subscriber Pattern",id:"basic-subscriber-pattern",level:3},{value:"Convenience Function",id:"convenience-function",level:3},{value:"Simplified McpAppTool Component",id:"simplified-mcpapptool-component",level:2},{value:"Integration Examples",id:"integration-examples",level:2},{value:"With CopilotKit",id:"with-copilotkit",level:3},{value:"With Custom HttpAgent",id:"with-custom-httpagent",level:3},{value:"With LangGraph",id:"with-langgraph",level:3},{value:"Advanced Features",id:"advanced-features",level:2},{value:"McpAppEventManager",id:"mcpappeventmanager",level:3},{value:"Transparent Tool Name Handling",id:"transparent-tool-name-handling",level:3},{value:"Combining Metadata and Events",id:"combining-metadata-and-events",level:3},{value:"Middleware Setup",id:"middleware-setup",level:2},{value:"API Reference",id:"api-reference",level:2},{value:"Hooks",id:"hooks",level:3},{value:"Functions",id:"functions",level:3},{value:"Classes",id:"classes",level:3},{value:"Types",id:"types",level:3},{value:"Benefits",id:"benefits",level:2},{value:"Troubleshooting",id:"troubleshooting",level:2},{value:"Apps not rendering?",id:"apps-not-rendering",level:3},{value:"Infinite render loops?",id:"infinite-render-loops",level:3},{value:"Next Steps",id:"next-steps",level:2}];function p(e){const n={a:"a",code:"code",h2:"h2",h3:"h3",li:"li",mermaid:"mermaid",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,i.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("h1",{children:[(0,r.jsx)("img",{src:"/mcp-ts/img/agent-framework/agui.webp",height:"32",style:{verticalAlign:"middle",marginRight:"10px",display:"inline"}})," AG-UI Subscriber Pattern"]}),"\n",(0,r.jsx)(n.p,{children:"Framework-agnostic event-driven system for handling MCP app rendering using AG-UI's subscriber pattern. Works with any AG-UI agent without depending on CopilotKit components."}),"\n",(0,r.jsx)(n.h2,{id:"overview",children:"Overview"}),"\n",(0,r.jsx)(n.p,{children:"The AG-UI subscriber pattern allows you to listen to agent events (tool calls, custom events, state changes) regardless of what UI framework you're using. This makes MCP apps portable across different agent implementations (HttpAgent, LangGraphAgent, custom agents)."}),"\n",(0,r.jsx)(n.h2,{id:"architecture",children:"Architecture"}),"\n",(0,r.jsx)(n.mermaid,{value:'flowchart TB\n    Agent["AG-UI Agent<br/>(HttpAgent, LangGraphAgent, custom implementation)"]\n    Subscriber["createMcpAppSubscriber()<br/>\u2022 Listens for \'mcp-apps-ui\' custom events<br/>\u2022 Tracks tool call lifecycle<br/>\u2022 Framework-agnostic event handlers"]\n    App["Your Application (React, Vue, Svelte, etc.)<br/>\u2022 Render MCP apps based on events<br/>\u2022 Display tool call status<br/>\u2022 Custom UI logic"]\n\n    Agent --\x3e|agent.subscribe(subscriber)| Subscriber\n    Subscriber --\x3e|Event callbacks| App\n\n    style Agent fill:#e3f2fd,stroke:#1976d2,stroke-width:2px\n    style Subscriber fill:#f3e5f5,stroke:#7b1fa2,stroke-width:2px\n    style App fill:#e8f5e9,stroke:#388e3c,stroke-width:2px'}),"\n",(0,r.jsx)(n.h2,{id:"installation",children:"Installation"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"npm install @mcp-ts/sdk @ag-ui/client rxjs\n"})}),"\n",(0,r.jsx)(n.h2,{id:"how-ag-ui-subscriber-fits-in-the-flow",children:"How AG-UI Subscriber Fits in the Flow"}),"\n",(0,r.jsxs)(n.p,{children:["The AG-UI subscriber pattern is the ",(0,r.jsx)(n.strong,{children:"event bridge"})," that connects the agent's tool execution to your React components:"]}),"\n",(0,r.jsx)(n.mermaid,{value:"sequenceDiagram\n    participant Agent as AG-UI Agent\n    participant Middleware as McpMiddleware (Server)\n    participant Subscriber as createMcpAppSubscriber\n    participant useMcpApps as useMcpApps Hook\n    participant Manager as McpAppEventManager\n    participant Component as React Component\n\n    rect rgb(230, 245, 255)\n    Note over Agent,Component: Setup Phase\n    useMcpApps->>Manager: Create event manager\n    useMcpApps->>Subscriber: createMcpAppSubscriber(config)\n    Note right of Subscriber: Creates subscriber<br/>with event handlers\n    useMcpApps->>Agent: agent.subscribe(subscriber)\n    Note right of Agent: Agent now emits<br/>events to subscriber\n    end\n\n    rect rgb(255, 245, 230)\n    Note over Agent,Component: Tool Execution Phase\n    Agent->>Middleware: Execute MCP tool\n    Middleware->>Middleware: Check if tool has UI metadata\n    Note right of Middleware: Tool has _meta.ui.resourceUri\n    Middleware->>Agent: Emit 'mcp-apps-ui' custom event\n    Note right of Middleware: Event payload:<br/>{ toolCallId, resourceUri,<br/>sessionId, toolName,<br/>result, input, status }\n    end\n\n    rect rgb(240, 255, 240)\n    Note over Agent,Component: Event Propagation\n    Agent->>Subscriber: onCustomEvent('mcp-apps-ui')\n    Subscriber->>Subscriber: Parse event payload\n    Note right of Subscriber: Extract McpAppEvent<br/>from event data\n    Subscriber->>Manager: Update event in manager\n    Manager->>Manager: Store event by toolName\n    Manager->>Manager: Update cached snapshot\n    Note right of Manager: Only creates new<br/>object if data changed\n    Manager->>useMcpApps: Notify subscribers\n    useMcpApps->>Component: Trigger re-render\n    Note right of Component: Component receives<br/>updated apps object\n    end\n\n    rect rgb(255, 240, 255)\n    Note over Agent,Component: Tool Call Lifecycle (Optional)\n    Agent->>Subscriber: onToolCallStartEvent\n    Subscriber->>Manager: Track tool call start\n    Agent->>Subscriber: onToolCallArgsEvent\n    Subscriber->>Manager: Track tool arguments\n    Agent->>Subscriber: onToolCallEndEvent\n    Subscriber->>Manager: Track tool completion\n    Agent->>Subscriber: onToolCallResultEvent\n    Subscriber->>Manager: Track tool result\n    Note right of Subscriber: These events help<br/>track execution state\n    end"}),"\n",(0,r.jsx)(n.h3,{id:"what-each-component-does",children:"What Each Component Does"}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Component"}),(0,r.jsx)(n.th,{children:"Role"}),(0,r.jsx)(n.th,{children:"Purpose"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.strong,{children:"createMcpAppSubscriber"})}),(0,r.jsx)(n.td,{children:"Event listener factory"}),(0,r.jsx)(n.td,{children:"Creates an AG-UI subscriber that listens for 'mcp-apps-ui' events"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.strong,{children:"useAguiSubscriber"})}),(0,r.jsx)(n.td,{children:"React hook for custom logic"}),(0,r.jsx)(n.td,{children:"Attaches subscriber to agent with custom event handlers (side effects only)"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.strong,{children:"useMcpApps"})}),(0,r.jsx)(n.td,{children:"Main React hook"}),(0,r.jsx)(n.td,{children:"Combines metadata + events + state management in one hook"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.strong,{children:"McpAppEventManager"})}),(0,r.jsx)(n.td,{children:"State manager"}),(0,r.jsx)(n.td,{children:"Stores events, creates cached snapshots, notifies React of changes"})]})]})]}),"\n",(0,r.jsx)(n.h3,{id:"key-differences",children:"Key Differences"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"createMcpAppSubscriber"})," (Framework-agnostic):"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Pure JavaScript function"}),"\n",(0,r.jsx)(n.li,{children:"Works with any AG-UI agent"}),"\n",(0,r.jsx)(n.li,{children:"No React dependency"}),"\n",(0,r.jsx)(n.li,{children:"Manual state management required"}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"useAguiSubscriber"})," (React hook for side effects):"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["React hook that uses ",(0,r.jsx)(n.code,{children:"createMcpAppSubscriber"})," internally"]}),"\n",(0,r.jsx)(n.li,{children:"Handles subscription/cleanup lifecycle"}),"\n",(0,r.jsx)(n.li,{children:"For custom event handling logic"}),"\n",(0,r.jsx)(n.li,{children:"You manage state yourself"}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"useMcpApps"})," (Complete React solution):"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"High-level React hook"}),"\n",(0,r.jsxs)(n.li,{children:["Built-in state management with ",(0,r.jsx)(n.code,{children:"useSyncExternalStore"})]}),"\n",(0,r.jsx)(n.li,{children:"Combines tool metadata + events automatically"}),"\n",(0,r.jsx)(n.li,{children:"Cached snapshots for performance"}),"\n",(0,r.jsxs)(n.li,{children:["Returns ready-to-use ",(0,r.jsx)(n.code,{children:"apps"})," object"]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"core-concepts",children:"Core Concepts"}),"\n",(0,r.jsx)(n.h3,{id:"mcpappevent",children:"McpAppEvent"}),"\n",(0,r.jsx)(n.p,{children:"Events emitted by the middleware when a tool with UI metadata is executed:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:"interface McpAppEvent {\n  toolCallId: string;      // Unique ID for this tool call\n  resourceUri: string;     // URL of the MCP app to load\n  sessionId?: string;      // MCP session ID\n  toolName: string;        // Tool name (base name, not prefixed)\n  result?: any;           // Tool execution result\n  input?: Record<string, unknown>; // Tool input arguments\n  status?: 'executing' | 'inProgress' | 'complete';\n}\n"})}),"\n",(0,r.jsx)(n.h3,{id:"tool-name-handling",children:"Tool Name Handling"}),"\n",(0,r.jsx)(n.p,{children:"The system transparently handles both base and prefixed tool names:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Base names"}),": ",(0,r.jsx)(n.code,{children:'"get-time"'})," (from MCP server)"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Prefixed names"}),": ",(0,r.jsx)(n.code,{children:'"tool_abc123_get-time"'})," (from CopilotKit/AG-UI)"]}),"\n",(0,r.jsx)(n.li,{children:"A JavaScript Proxy automatically handles both formats when looking up apps"}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"react-hooks",children:"React Hooks"}),"\n",(0,r.jsx)(n.h3,{id:"usemcpapps",children:"useMcpApps"}),"\n",(0,r.jsx)(n.p,{children:"Main hook for managing MCP apps. Combines tool metadata (instant, synchronous) with AG-UI events (async, real-time updates)."}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:"import { useMcpApps } from '@mcp-ts/sdk/client/react';\nimport { useAgent } from '@copilotkit/react-core/v2';\nimport { useMcpContext } from './mcp-provider';\n\nfunction ToolRenderer() {\n  const { agent } = useAgent({ agentId: \"myAgent\" });\n  const { mcpClient } = useMcpContext();\n\n  // \u2728 One hook to rule them all!\n  const { apps, getApp, clear } = useMcpApps(agent, mcpClient);\n\n  return (\n    <div>\n      {Object.entries(apps).map(([toolName, app]) => (\n        <div key={toolName}>\n          <McpAppTool app={app} />\n        </div>\n      ))}\n    </div>\n  );\n}\n"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Features:"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"\u2705 Combines tool metadata (instant loading) with events (real-time updates)"}),"\n",(0,r.jsx)(n.li,{children:"\u2705 Transparent tool name handling (works with both base and prefixed names)"}),"\n",(0,r.jsxs)(n.li,{children:["\u2705 Uses ",(0,r.jsx)(n.code,{children:"useSyncExternalStore"})," for optimal React 18+ performance"]}),"\n",(0,r.jsxs)(n.li,{children:["\u2705 Returns ",(0,r.jsx)(n.code,{children:"apps"})," object indexed by tool name"]}),"\n",(0,r.jsxs)(n.li,{children:["\u2705 Provides ",(0,r.jsx)(n.code,{children:"getApp(name)"})," helper for specific tool lookup"]}),"\n",(0,r.jsxs)(n.li,{children:["\u2705 Provides ",(0,r.jsx)(n.code,{children:"clear()"})," to reset all apps"]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Return Value:"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:"{\n  apps: Record<string, McpAppEvent>;  // All MCP apps indexed by tool name\n  getApp: (toolName: string) => McpAppEvent | undefined;  // Get specific app\n  clear: () => void;  // Clear all apps\n}\n"})}),"\n",(0,r.jsx)(n.h3,{id:"useaguisubscriber",children:"useAguiSubscriber"}),"\n",(0,r.jsx)(n.p,{children:"For custom event handling without built-in state management:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:"import { useAguiSubscriber } from '@mcp-ts/sdk/client/react';\nimport { useState } from 'react';\nimport { HttpAgent } from '@ag-ui/client';\n\nfunction MyComponent() {\n  const [agent] = useState(() => new HttpAgent({ url: '/api/agent' }));\n  const [mcpApps, setMcpApps] = useState({});\n\n  useAguiSubscriber(agent, {\n    onMcpApp: (event) => {\n      setMcpApps(prev => ({\n        ...prev,\n        [event.toolName]: event\n      }));\n    },\n    onToolCall: (event) => {\n      console.log('Tool:', event.toolName, event.status);\n    }\n  });\n\n  return (\n    <div>\n      {Object.values(mcpApps).map(app => (\n        <McpAppTool key={app.toolName} app={app} />\n      ))}\n    </div>\n  );\n}\n"})}),"\n",(0,r.jsx)(n.h3,{id:"usetoolcallevents",children:"useToolCallEvents"}),"\n",(0,r.jsx)(n.p,{children:"Track detailed tool call events for debugging or custom UI:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:"import { useToolCallEvents } from '@mcp-ts/sdk/client/react';\n\nfunction ToolCallDebugger() {\n  const [agent] = useState(() => new HttpAgent({ url: '/api/agent' }));\n  const { toolCalls } = useToolCallEvents(agent);\n\n  return (\n    <div>\n      {Object.entries(toolCalls).map(([id, event]) => (\n        <div key={id}>\n          {event.toolName} - {event.status}\n        </div>\n      ))}\n    </div>\n  );\n}\n"})}),"\n",(0,r.jsx)(n.h2,{id:"framework-agnostic-usage",children:"Framework-Agnostic Usage"}),"\n",(0,r.jsx)(n.h3,{id:"basic-subscriber-pattern",children:"Basic Subscriber Pattern"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:"import { createMcpAppSubscriber } from '@mcp-ts/sdk/client/react';\nimport { HttpAgent } from '@ag-ui/client';\n\n// Create an AG-UI agent (any type)\nconst agent = new HttpAgent({\n  url: '/api/agent',\n});\n\n// Create a subscriber\nconst subscriber = createMcpAppSubscriber({\n  onMcpApp: (event) => {\n    console.log('MCP App UI needed:', event);\n    renderMcpApp({\n      resourceUri: event.resourceUri,\n      sessionId: event.sessionId,\n      toolInput: event.input,\n      toolResult: event.result\n    });\n  },\n  onToolCall: (event) => {\n    console.log('Tool call:', event.toolName, event.status);\n  }\n});\n\n// Attach subscriber to agent\nconst { unsubscribe } = agent.subscribe(subscriber);\n\n// Later, cleanup\nunsubscribe();\n"})}),"\n",(0,r.jsx)(n.h3,{id:"convenience-function",children:"Convenience Function"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:"import { subscribeMcpAppEvents } from '@mcp-ts/sdk/client/react';\n\nconst unsubscribe = subscribeMcpAppEvents(agent, {\n  onMcpApp: (event) => {\n    // Handle MCP app rendering\n  }\n});\n"})}),"\n",(0,r.jsx)(n.h2,{id:"simplified-mcpapptool-component",children:"Simplified McpAppTool Component"}),"\n",(0,r.jsxs)(n.p,{children:["The ",(0,r.jsx)(n.code,{children:"McpAppTool"})," component now accepts the ",(0,r.jsx)(n.code,{children:"app"})," object directly:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:"import { McpAppTool } from './McpAppTool';\nimport { useMcpApps } from '@mcp-ts/sdk/client/react';\n\nfunction ToolRenderer({ name, args, result, status }) {\n  const { agent } = useAgent({ agentId: \"myAgent\" });\n  const { mcpClient } = useMcpContext();\n  const { apps } = useMcpApps(agent, mcpClient);\n\n  // Look up app by tool name (works with both base and prefixed names!)\n  const app = apps[name];\n\n  return (\n    <div>\n      {/* Simple: just pass the app object */}\n      {app && <McpAppTool app={app} />}\n\n      {/* Or with overrides */}\n      {app && (\n        <McpAppTool\n          app={app}\n          toolInput={args}      // Optional override\n          toolResult={result}   // Optional override\n          toolStatus={status}   // Optional override\n        />\n      )}\n    </div>\n  );\n}\n"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Old API (verbose):"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:"<McpAppTool\n  resourceUri={app.resourceUri}\n  sessionId={app.sessionId}\n  toolInput={args}\n  toolResult={result}\n  toolStatus={status}\n/>\n"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"New API (clean):"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:"<McpAppTool app={app} />\n"})}),"\n",(0,r.jsx)(n.h2,{id:"integration-examples",children:"Integration Examples"}),"\n",(0,r.jsx)(n.h3,{id:"with-copilotkit",children:"With CopilotKit"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:'import { useAgent } from "@copilotkit/react-core/v2";\nimport { useMcpApps } from "@mcp-ts/sdk/client/react";\nimport { useMcpContext } from "./mcp-provider";\n\nfunction CopilotKitApp() {\n  const { agent } = useAgent({ agentId: "myAgent" });\n  const { mcpClient } = useMcpContext();\n  const { apps } = useMcpApps(agent, mcpClient);\n\n  return (\n    <div>\n      {Object.values(apps).map(app => (\n        <McpAppTool key={app.toolName} app={app} />\n      ))}\n    </div>\n  );\n}\n'})}),"\n",(0,r.jsx)(n.h3,{id:"with-custom-httpagent",children:"With Custom HttpAgent"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:"import { HttpAgent } from '@ag-ui/client';\nimport { useMcpApps } from '@mcp-ts/sdk/client/react';\n\nfunction CustomAgentApp() {\n  const [agent] = useState(() => new HttpAgent({ url: '/api/agent' }));\n  const { apps } = useMcpApps(agent);\n\n  return (\n    <div>\n      {Object.values(apps).map(app => (\n        <McpAppTool key={app.toolName} app={app} />\n      ))}\n    </div>\n  );\n}\n"})}),"\n",(0,r.jsx)(n.h3,{id:"with-langgraph",children:"With LangGraph"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:"import { LangGraphAgent } from '@ag-ui/langgraph';\nimport { createMcpAppSubscriber } from '@mcp-ts/sdk/client/react';\n\nconst agent = new LangGraphAgent({\n  // LangGraph config\n});\n\nagent.subscribe(createMcpAppSubscriber({\n  onMcpApp: (event) => {\n    // Render MCP app\n  }\n}));\n"})}),"\n",(0,r.jsx)(n.h2,{id:"advanced-features",children:"Advanced Features"}),"\n",(0,r.jsx)(n.h3,{id:"mcpappeventmanager",children:"McpAppEventManager"}),"\n",(0,r.jsxs)(n.p,{children:["The ",(0,r.jsx)(n.code,{children:"McpAppEventManager"})," class provides built-in state management with cached snapshots:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:"import { McpAppEventManager } from '@mcp-ts/sdk/client/react';\n\nconst manager = new McpAppEventManager();\n\n// Attach to agent\nmanager.attach(agent);\n\n// Get specific event\nconst event = manager.getEvent('my_tool');\n\n// Get all events (cached reference for useSyncExternalStore)\nconst allEvents = manager.getAllEvents();\n\n// Subscribe to changes\nconst unsubscribe = manager.subscribe(() => {\n  console.log('Events changed!');\n});\n\n// Clear all events\nmanager.clear();\n\n// Detach from agent\nmanager.detach();\n"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Why cached snapshots?"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Prevents infinite render loops in ",(0,r.jsx)(n.code,{children:"useSyncExternalStore"})]}),"\n",(0,r.jsx)(n.li,{children:"Only creates new object reference when data actually changes"}),"\n",(0,r.jsx)(n.li,{children:"Standard React 18+ pattern for external stores"}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"transparent-tool-name-handling",children:"Transparent Tool Name Handling"}),"\n",(0,r.jsxs)(n.p,{children:["The ",(0,r.jsx)(n.code,{children:"apps"})," object uses a JavaScript Proxy to handle both base and prefixed tool names:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:'const { apps } = useMcpApps(agent, mcpClient);\n\n// Both of these work!\nconst app1 = apps["get-time"];                    // Base name\nconst app2 = apps["tool_abc123_get-time"];        // Prefixed name\n\n// app1 === app2 (same object!)\n'})}),"\n",(0,r.jsx)(n.h3,{id:"combining-metadata-and-events",children:"Combining Metadata and Events"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.code,{children:"useMcpApps"})," intelligently combines two data sources:"]}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Tool Metadata"})," (synchronous, instant):"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["From ",(0,r.jsx)(n.code,{children:"mcpClient.connections[].tools[]"})]}),"\n",(0,r.jsx)(n.li,{children:"Available immediately when tools are discovered"}),"\n",(0,r.jsxs)(n.li,{children:["Provides ",(0,r.jsx)(n.code,{children:"resourceUri"}),", ",(0,r.jsx)(n.code,{children:"sessionId"}),", ",(0,r.jsx)(n.code,{children:"toolName"})]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"AG-UI Events"})," (asynchronous, real-time):"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"From agent's event stream after tool execution"}),"\n",(0,r.jsxs)(n.li,{children:["Provides ",(0,r.jsx)(n.code,{children:"toolCallId"}),", ",(0,r.jsx)(n.code,{children:"result"}),", ",(0,r.jsx)(n.code,{children:"input"}),", ",(0,r.jsx)(n.code,{children:"status"})]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"The hook merges them:"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:'// Initial state (from metadata):\n{\n  "get-time": {\n    toolCallId: "",\n    resourceUri: "http://...",\n    sessionId: "abc123",\n    toolName: "get-time"\n  }\n}\n\n// After tool execution (merged with event):\n{\n  "get-time": {\n    toolCallId: "call_xyz",\n    resourceUri: "http://...",\n    sessionId: "abc123",\n    toolName: "get-time",\n    result: { ... },\n    input: { ... },\n    status: "complete"\n  }\n}\n'})}),"\n",(0,r.jsx)(n.h2,{id:"middleware-setup",children:"Middleware Setup"}),"\n",(0,r.jsxs)(n.p,{children:["Server-side middleware automatically emits ",(0,r.jsx)(n.code,{children:"mcp-apps-ui"})," custom events:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:"// Server-side (Node.js)\nimport { McpMiddleware } from '@mcp-ts/sdk/adapters/agui-middleware';\nimport { AguiAdapter } from '@mcp-ts/sdk/adapters/agui-adapter';\n\nconst adapter = new AguiAdapter(mcpClient);\nconst tools = await adapter.getTools();\n\nconst middleware = new McpMiddleware({ tools });\n\n// The middleware automatically:\n// 1. Executes MCP tools server-side\n// 2. Emits 'mcp-apps-ui' custom events when tools have UI metadata\n// 3. Includes toolCallId, resourceUri, sessionId, result in event payload\n"})}),"\n",(0,r.jsx)(n.h2,{id:"api-reference",children:"API Reference"}),"\n",(0,r.jsx)(n.h3,{id:"hooks",children:"Hooks"}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Hook"}),(0,r.jsx)(n.th,{children:"Description"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"useMcpApps(agent?, mcpClient?)"})}),(0,r.jsx)(n.td,{children:"Main hook combining metadata + events"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"useAguiSubscriber(agent, config)"})}),(0,r.jsx)(n.td,{children:"Side-effect hook for custom logic"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"useToolCallEvents(agent)"})}),(0,r.jsx)(n.td,{children:"Tool call lifecycle tracking"})]})]})]}),"\n",(0,r.jsx)(n.h3,{id:"functions",children:"Functions"}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Function"}),(0,r.jsx)(n.th,{children:"Description"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"createMcpAppSubscriber(config)"})}),(0,r.jsx)(n.td,{children:"Creates an AG-UI subscriber"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"subscribeMcpAppEvents(agent, config)"})}),(0,r.jsx)(n.td,{children:"Convenience function"})]})]})]}),"\n",(0,r.jsx)(n.h3,{id:"classes",children:"Classes"}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Class"}),(0,r.jsx)(n.th,{children:"Description"})]})}),(0,r.jsx)(n.tbody,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"McpAppEventManager"})}),(0,r.jsx)(n.td,{children:"State management with cached snapshots"})]})})]}),"\n",(0,r.jsx)(n.h3,{id:"types",children:"Types"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:"interface McpAppEvent {\n  toolCallId: string;\n  resourceUri: string;\n  sessionId?: string;\n  toolName: string;\n  result?: any;\n  input?: Record<string, unknown>;\n  status?: 'executing' | 'inProgress' | 'complete';\n}\n\ninterface McpAppSubscriberConfig {\n  onMcpApp?: (event: McpAppEvent) => void;\n  onToolCall?: (event: ToolCallEventData) => void;\n  eventName?: string;  // Default: 'mcp-apps-ui'\n}\n\ninterface ToolCallEventData {\n  toolCallId: string;\n  toolName: string;\n  args?: Record<string, unknown>;\n  result?: any;\n  status: 'start' | 'args' | 'end' | 'result';\n}\n"})}),"\n",(0,r.jsx)(n.h2,{id:"benefits",children:"Benefits"}),"\n",(0,r.jsxs)(n.p,{children:["\u2705 ",(0,r.jsx)(n.strong,{children:"Framework-Agnostic"})," - Works with any AG-UI agent\n\u2705 ",(0,r.jsx)(n.strong,{children:"No CopilotKit Dependency"})," - Use with any UI framework\n\u2705 ",(0,r.jsx)(n.strong,{children:"Type-Safe"})," - Full TypeScript support\n\u2705 ",(0,r.jsx)(n.strong,{children:"Flexible"})," - Multiple integration patterns\n\u2705 ",(0,r.jsx)(n.strong,{children:"Efficient"})," - Built-in state management with ",(0,r.jsx)(n.code,{children:"useSyncExternalStore"}),"\n\u2705 ",(0,r.jsx)(n.strong,{children:"Clean Architecture"})," - Separation of concerns\n\u2705 ",(0,r.jsx)(n.strong,{children:"Transparent Naming"})," - Handles both base and prefixed tool names\n\u2705 ",(0,r.jsx)(n.strong,{children:"Instant Loading"})," - Combines metadata (instant) with events (real-time)\n\u2705 ",(0,r.jsx)(n.strong,{children:"Serverless Compatible"})," - Client-side state management"]}),"\n",(0,r.jsx)(n.h2,{id:"troubleshooting",children:"Troubleshooting"}),"\n",(0,r.jsx)(n.h3,{id:"apps-not-rendering",children:"Apps not rendering?"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Check middleware is emitting events"}),": Add ",(0,r.jsx)(n.code,{children:"console.log"})," in ",(0,r.jsx)(n.code,{children:"onMcpApp"})," handler"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Check tool has UI metadata"}),": Tool must have ",(0,r.jsx)(n.code,{children:"_meta.ui.resourceUri"})," or ",(0,r.jsx)(n.code,{children:'_meta["ui/resourceUri"]'})]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Check tool name matching"}),": Use browser devtools to verify tool names in events vs. metadata"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Verify agent subscription"}),": Make sure agent is passed to ",(0,r.jsx)(n.code,{children:"useMcpApps"})]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"infinite-render-loops",children:"Infinite render loops?"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["The ",(0,r.jsx)(n.code,{children:"McpAppEventManager"})," uses cached snapshots to prevent this"]}),"\n",(0,r.jsx)(n.li,{children:"Only creates new object references when data actually changes"}),"\n",(0,r.jsxs)(n.li,{children:["This is the standard React 18+ pattern for ",(0,r.jsx)(n.code,{children:"useSyncExternalStore"})]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"next-steps",children:"Next Steps"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.a,{href:"/mcp-ts/docs/adapters#ag-ui-adapter",children:"AG-UI Adapter"})," - Server-side adapter documentation"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.a,{href:"/mcp-ts/docs/api-reference",children:"API Reference"})," - Complete API documentation"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.a,{href:"/mcp-ts/docs/mcp-apps",children:"MCP Apps"})," - Learn about MCP app rendering"]}),"\n"]})]})}function d(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(p,{...e})}):p(e)}}}]);