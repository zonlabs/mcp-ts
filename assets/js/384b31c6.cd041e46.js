"use strict";(globalThis.webpackChunkdocs=globalThis.webpackChunkdocs||[]).push([[3667],{4968(e,n,t){t.r(n),t.d(n,{assets:()=>l,contentTitle:()=>a,default:()=>u,frontMatter:()=>c,metadata:()=>s,toc:()=>d});const s=JSON.parse('{"id":"nextjs","title":"Next.js","description":"Next.js","source":"@site/docs/nextjs.md","sourceDirName":".","slug":"/nextjs","permalink":"/mcp-ts/docs/nextjs","draft":false,"unlisted":false,"editUrl":"https://github.com/zonlabs/mcp-ts/tree/main/docs/docs/nextjs.md","tags":[],"version":"current","frontMatter":{"title":"Next.js","hide_title":true},"sidebar":"tutorialSidebar","previous":{"title":"Storage Backends","permalink":"/mcp-ts/docs/storage-backends"},"next":{"title":"Express.js","permalink":"/mcp-ts/docs/node-express"}}');var r=t(4848),o=t(8453),i=t(712);const c={title:"Next.js",hide_title:!0},a=void 0,l={},d=[{value:"App Router (Recommended)",id:"app-router-recommended",level:2},{value:"Step 1: Create API Route",id:"step-1-create-api-route",level:3},{value:"Step 2: Create Client Component",id:"step-2-create-client-component",level:3},{value:"Step 3: Use in Page",id:"step-3-use-in-page",level:3},{value:"AI SDK",id:"ai-sdk",level:2},{value:"Pages Router",id:"pages-router",level:2},{value:"Step 1: Create API Route",id:"step-1-create-api-route-1",level:3},{value:"Step 2: Create Component",id:"step-2-create-component",level:3},{value:"Step 3: Use in Page",id:"step-3-use-in-page-1",level:3},{value:"OAuth Callback Handler",id:"oauth-callback-handler",level:2},{value:"Environment Variables",id:"environment-variables",level:2},{value:"Production Deployment",id:"production-deployment",level:2},{value:"Vercel",id:"vercel",level:3},{value:"Other Platforms",id:"other-platforms",level:3},{value:"Complete Example",id:"complete-example",level:2},{value:"Next Steps",id:"next-steps",level:2}];function p(e){const n={a:"a",code:"code",h2:"h2",h3:"h3",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,o.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("h1",{children:[(0,r.jsx)(i.wlC,{style:{verticalAlign:"middle",marginRight:"10px"}})," Next.js"]}),"\n",(0,r.jsx)(n.p,{children:"Complete guide for integrating mcp-ts with Next.js applications (App Router and Pages Router)."}),"\n",(0,r.jsx)(n.h2,{id:"app-router-recommended",children:"App Router (Recommended)"}),"\n",(0,r.jsx)(n.h3,{id:"step-1-create-api-route",children:"Step 1: Create API Route"}),"\n",(0,r.jsxs)(n.p,{children:["Create an API route handler at ",(0,r.jsx)(n.code,{children:"app/api/mcp/route.ts"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:"import { createNextMcpHandler } from '@mcp-ts/sdk/server';\n\nexport const dynamic = 'force-dynamic';\nexport const runtime = 'nodejs';\n\nexport const { GET, POST } = createNextMcpHandler({\n  // Extract identity from request\n  getIdentity: (request) => {\n    return new URL(request.url).searchParams.get('identity');\n  },\n\n  // Optional: Custom authentication\n  authenticate: async (identity, token) => {\n    // Verify token with your auth system\n    return true; // or throw error if invalid\n  },\n\n  // Optional: Heartbeat interval\n  heartbeatInterval: 30000, // 30 seconds\n});\n"})}),"\n",(0,r.jsx)(n.h3,{id:"step-2-create-client-component",children:"Step 2: Create Client Component"}),"\n",(0,r.jsxs)(n.p,{children:["Create a component at ",(0,r.jsx)(n.code,{children:"components/McpConnections.tsx"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:"'use client';\n\nimport { useMcp } from '@mcp-ts/sdk/client';\n\nexport function McpConnections({ identity }: { identity: string }) {\n  const {\n    connections,\n    status,\n    connect,\n    disconnect,\n    callTool,\n  } = useMcp({\n    url: `/api/mcp?identity=${identity}`,\n    identity,\n    autoConnect: true,\n  });\n\n  const handleConnect = async () => {\n    await connect({\n      serverId: 'my-server',\n      serverName: 'My MCP Server',\n      serverUrl: 'https://mcp.example.com',\n      callbackUrl: window.location.origin + '/api/mcp/callback',\n    });\n  };\n\n  return (\n    <div>\n      <div>\n        <h2>MCP Connections</h2>\n        <p>Status: <strong>{status}</strong></p>\n        <button onClick={handleConnect}>\n          Connect to Server\n        </button>\n      </div>\n\n      {connections.map((conn) => (\n        <div key={conn.sessionId}>\n          <h3>{conn.serverName}</h3>\n          <p>State: {conn.state}</p>\n          <p>Available Tools: {conn.tools.length}</p>\n\n          {conn.state === 'CONNECTED' && (\n            <div>\n              {conn.tools.map((tool) => (\n                <button\n                  key={tool.name}\n                  onClick={() => callTool(conn.sessionId, tool.name, {})}\n                >\n                  {tool.name}\n                </button>\n              ))}\n              <button onClick={() => disconnect(conn.sessionId)}>\n                Disconnect\n              </button>\n            </div>\n          )}\n        </div>\n      ))}\n    </div>\n  );\n}\n"})}),"\n",(0,r.jsx)(n.h3,{id:"step-3-use-in-page",children:"Step 3: Use in Page"}),"\n",(0,r.jsxs)(n.p,{children:["Use the component in your page at ",(0,r.jsx)(n.code,{children:"app/page.tsx"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:"import { McpConnections } from '@/components/McpConnections';\n\nexport default function Home() {\n  // Get identity from your auth system\n  const identity = 'user-123'; // Replace with actual identity\n\n  return (\n    <main>\n      <h1>My App</h1>\n      <McpConnections identity={identity} />\n    </main>\n  );\n}\n"})}),"\n",(0,r.jsx)(n.h2,{id:"ai-sdk",children:"AI SDK"}),"\n",(0,r.jsxs)(n.p,{children:["To build agentic workflows that use tools from multiple MCP servers, use ",(0,r.jsx)(n.code,{children:"MultiSessionClient"}),"."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:"// app/api/chat/route.ts\nimport { MultiSessionClient } from '@mcp-ts/sdk/server';\nimport { AIAdapter } from '@mcp-ts/sdk/adapters/ai';\nimport { streamText } from 'ai';\nimport { openai } from '@ai-sdk/openai';\n\nexport async function POST(req: Request) {\n  const { messages, identity } = await req.json();\n\n  const client = new MultiSessionClient(identity);\n\n  try {\n    await client.connect();\n\n    const adapter = new AIAdapter(client);\n    const tools = await adapter.getTools();\n\n    const result = streamText({\n      model: openai('gpt-4'),\n      messages,\n      tools,\n      onFinish: async () => {\n        await mcp.disconnect();\n      }\n    });\n\n    return result.toDataStreamResponse();\n  } catch (error) {\n    await mcp.disconnect();\n    throw error;\n  }\n}\n"})}),"\n",(0,r.jsxs)(n.p,{children:["For more details, see the ",(0,r.jsx)(n.a,{href:"/mcp-ts/docs/adapters#ai-sdk-adapter",children:"AI SDK Adapter documentation"}),"."]}),"\n",(0,r.jsx)(n.h2,{id:"pages-router",children:"Pages Router"}),"\n",(0,r.jsx)(n.h3,{id:"step-1-create-api-route-1",children:"Step 1: Create API Route"}),"\n",(0,r.jsxs)(n.p,{children:["Create ",(0,r.jsx)(n.code,{children:"pages/api/mcp/sse.ts"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:"import { createSSEHandler } from '@mcp-ts/sdk/server';\nimport type { NextApiRequest, NextApiResponse } from 'next';\n\nexport default async function handler(\n  req: NextApiRequest,\n  res: NextApiResponse\n) {\n  const identity = req.query.identity as string;\n\n  if (!identity) {\n    return res.status(400).json({ error: 'identity required' });\n  }\n\n  const sseHandler = createSSEHandler({\n    identity,\n    heartbeatInterval: 30000,\n  });\n\n  return sseHandler(req, res);\n}\n"})}),"\n",(0,r.jsx)(n.h3,{id:"step-2-create-component",children:"Step 2: Create Component"}),"\n",(0,r.jsx)(n.p,{children:"Same as App Router component above."}),"\n",(0,r.jsx)(n.h3,{id:"step-3-use-in-page-1",children:"Step 3: Use in Page"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:"import { McpConnections } from '@/components/McpConnections';\n\nexport default function Home() {\n  const identity = 'user-123';\n\n  return (\n    <div>\n      <h1>My App</h1>\n      <McpConnections identity={identity} />\n    </div>\n  );\n}\n"})}),"\n",(0,r.jsx)(n.h2,{id:"oauth-callback-handler",children:"OAuth Callback Handler"}),"\n",(0,r.jsxs)(n.p,{children:["Handle OAuth callbacks at ",(0,r.jsx)(n.code,{children:"app/oauth/callback-popup/page.tsx"})," (for popups) or ",(0,r.jsx)(n.code,{children:"app/oauth/callback/page.tsx"})," (for redirects):"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:"'use client';\n\nimport { useEffect } from 'react';\nimport { useSearchParams, useRouter } from 'next/navigation';\nimport { useMcp } from '@mcp-ts/sdk/client';\n\nexport default function OAuthCallback() {\n  const searchParams = useSearchParams();\n  const router = useRouter();\n  const { finishAuth } = useMcp({\n    url: '/api/mcp',\n    identity: 'user-123',\n  });\n\n  useEffect(() => {\n    const code = searchParams.get('code');\n    const state = searchParams.get('state');\n\n    if (code && state) {\n      finishAuth(code, state)\n        .then(() => {\n          router.push('/'); // Redirect back to main page\n        })\n        .catch((error) => {\n          console.error('OAuth failed:', error);\n        });\n    }\n  }, [searchParams, finishAuth, router]);\n\n  return <div>Completing authentication...</div>;\n}\n"})}),"\n",(0,r.jsx)(n.h2,{id:"environment-variables",children:"Environment Variables"}),"\n",(0,r.jsxs)(n.p,{children:["Add to ",(0,r.jsx)(n.code,{children:".env.local"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"# Redis connection\nREDIS_URL=redis://localhost:6379\n\n# Or for Upstash Redis\nREDIS_URL=rediss://default:password@host.upstash.io:6379\n"})}),"\n",(0,r.jsx)(n.h2,{id:"production-deployment",children:"Production Deployment"}),"\n",(0,r.jsx)(n.h3,{id:"vercel",children:"Vercel"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Add environment variable"})," in Vercel dashboard:"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"REDIS_URL"})," - Your Redis connection string"]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Deploy"}),":"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"vercel deploy\n"})}),"\n",(0,r.jsx)(n.h3,{id:"other-platforms",children:"Other Platforms"}),"\n",(0,r.jsx)(n.p,{children:"Ensure your platform supports:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Node.js runtime (for API routes)"}),"\n",(0,r.jsx)(n.li,{children:"Environment variables"}),"\n",(0,r.jsx)(n.li,{children:"WebSocket/SSE connections"}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"complete-example",children:"Complete Example"}),"\n",(0,r.jsx)(n.p,{children:"Here's a full working example:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",metastring:'title="app/api/mcp/route.ts"',children:"import { createNextMcpHandler } from '@mcp-ts/sdk/server';\n\nexport const dynamic = 'force-dynamic';\nexport const runtime = 'nodejs';\n\nexport const { GET, POST } = createNextMcpHandler({\n  getIdentity: (request) => {\n    const identity = new URL(request.url).searchParams.get('identity');\n    if (!identity) throw new Error('identity required');\n    return identity;\n  },\n});\n"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",metastring:'title="components/McpClient.tsx"',children:"'use client';\n\nimport { useMcp } from '@mcp-ts/sdk/client';\nimport { useState } from 'react';\n\nexport function McpClient({ identity }: { identity: string }) {\n  const { connections, connect, callTool, status } = useMcp({\n    url: `/api/mcp?identity=${identity}`,\n    identity,\n    autoConnect: true,\n  });\n\n  const [result, setResult] = useState<any>(null);\n\n  const handleToolCall = async (sessionId: string, toolName: string) => {\n    try {\n      const res = await callTool(sessionId, toolName, {});\n      setResult(res);\n    } catch (error) {\n      console.error('Tool call failed:', error);\n    }\n  };\n\n  return (\n    <div>\n      <h2>MCP Client ({status})</h2>\n\n      {connections.map(conn => (\n        <div key={conn.sessionId}>\n          <h3>{conn.serverName}</h3>\n          <p>{conn.state}</p>\n\n          {conn.tools.map(tool => (\n            <button\n              key={tool.name}\n              onClick={() => handleToolCall(conn.sessionId, tool.name)}\n            >\n              {tool.name}\n            </button>\n          ))}\n        </div>\n      ))}\n\n      {result && (\n        <pre>{JSON.stringify(result, null, 2)}</pre>\n      )}\n    </div>\n  );\n}\n"})}),"\n",(0,r.jsx)(n.h2,{id:"next-steps",children:"Next Steps"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.a,{href:"/mcp-ts/docs/react",children:"React Hook API"})," - Detailed hook documentation"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.a,{href:"/mcp-ts/docs/api-reference",children:"API Reference"})," - Complete API reference"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.a,{href:"https://github.com/zonlabs/mcp-ts/tree/main/examples",children:"Examples"})," - More code examples"]}),"\n"]})]})}function u(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(p,{...e})}):p(e)}}}]);